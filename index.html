<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>カード検索</title>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .filters { margin: 15px 0; }
    .filter-group { margin-bottom: 10px; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 5px 0; border-radius: 8px; }
    label { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>カード検索</h1>

  <!-- キーワード検索 -->
  <input type="text" id="search" placeholder="名前・テキスト検索">

  <!-- フィルター -->
  <div class="filters">
    <!-- レアリティ -->
    <div class="filter-group">
      <strong>レアリティ:</strong><br>
      <label><input type="checkbox" class="rarity" value="Common"> Common</label>
      <label><input type="checkbox" class="rarity" value="Rare"> Rare</label>
    </div>

    <!-- 色 -->
    <div class="filter-group">
      <strong>色:</strong><br>
      <label><input type="checkbox" class="color" value="Red"> Red</label>
      <label><input type="checkbox" class="color" value="White"> White</label>
      <label><input type="checkbox" class="color" value="Blue"> Blue</label>
      <label><input type="checkbox" class="color" value="Green"> Green</label>
    </div>

    <!-- コスト -->
    <div class="filter-group">
      <strong>コスト:</strong><br>
      <label><input type="radio" name="cost" value="" checked> 指定なし</label>
      <label><input type="radio" name="cost" value="low"> 5以下</label>
      <label><input type="radio" name="cost" value="high"> 6以上</label>
    </div>
  </div>

  <!-- 検索結果 -->
  <div id="results"></div>

  <script>
    async function init() {
      const res = await fetch("cards.json");
      const cards = await res.json();

      const fuse = new Fuse(cards, {
        keys: ["name", "text"],
        threshold: 0.3
      });

      function render(list) {
        document.getElementById("results").innerHTML =
          list.map(c => `<div class="card">
            <strong>${c.name}</strong> [${c.rarity}]<br>
            Type: ${c.type}, Cost: ${c.cost}, Atk: ${c.attack}, Color: ${c.color}<br>
            ${c.text}
          </div>`).join("");
      }

      function filter() {
        const keyword = document.getElementById("search").value;

        // Fuse.js でキーワード検索
        let results = keyword ? fuse.search(keyword).map(r => r.item) : cards;

        // レアリティフィルター
        const selectedRarity = Array.from(document.querySelectorAll(".rarity:checked")).map(cb => cb.value);
        if (selectedRarity.length > 0) {
          results = results.filter(c => selectedRarity.includes(c.rarity));
        }

        // 色フィルター
        const selectedColors = Array.from(document.querySelectorAll(".color:checked")).map(cb => cb.value);
        if (selectedColors.length > 0) {
          results = results.filter(c => selectedColors.includes(c.color));
        }

        // コストフィルター
        const costFilter = document.querySelector("input[name='cost']:checked").value;
        if (costFilter === "low") {
          results = results.filter(c => c.cost <= 5);
        } else if (costFilter === "high") {
          results = results.filter(c => c.cost >= 6);
        }

        render(results);
      }

      // イベントリスナー
      document.getElementById("search").addEventListener("input", filter);
      document.querySelectorAll(".rarity, .color, input[name='cost']").forEach(el => {
        el.addEventListener("change", filter);
      });

      render(cards);
    }
    init();
  </script>
</body>
</html>
